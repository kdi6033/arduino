# BLE를 이용한 IoT 보드 제어
![ble-001 (1)](https://user-images.githubusercontent.com/37902752/149690703-cf47836e-637d-4d96-a44a-9acaefde4fdb.png)


* node-red 소스 파일
```
[{"id":"9a2f3b4d3c0f4afd","type":"ble write","z":"12d2f38ca9326654","name":"쓰기","device":"e4a20789a9d815af","service":"6E400001-B5A3-F393-E0A9-E50E24DCCA9E","characteristic":"6E400002-B5A3-F393-E0A9-E50E24DCCA9E","x":1490,"y":560,"wires":[["b571e9eb5581790a"]]},{"id":"50dda69077952c53","type":"ui_slider","z":"12d2f38ca9326654","name":"","label":"밝기 조절","tooltip":"","group":"1c67a074.861f4","order":8,"width":0,"height":0,"passthru":true,"outs":"end","topic":"","topicType":"str","min":"0","max":"2500","step":"1","className":"","x":880,"y":760,"wires":[["1d70390fca0b5ecc","1d63c4b1d56dbaef"]]},{"id":"1d70390fca0b5ecc","type":"function","z":"12d2f38ca9326654","name":"","func":"msg.payload= \"{a:0, b:\"+msg.payload+\"}\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1120,"y":820,"wires":[["87310530bf95bee4"]]},{"id":"1b424d755edcf452","type":"ui_switch","z":"12d2f38ca9326654","name":"","label":"3번 전구","tooltip":"","group":"1c67a074.861f4","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","topicType":"str","style":"","onvalue":"0","onvalueType":"num","onicon":"","oncolor":"","offvalue":"1","offvalueType":"num","officon":"","offcolor":"","animate":false,"className":"","x":980,"y":560,"wires":[["4df861533fde5fcb"]]},{"id":"4df861533fde5fcb","type":"function","z":"12d2f38ca9326654","name":"","func":"msg.payload=\n    \"{'a':3, 'b':\" +msg.payload+\"}\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1140,"y":560,"wires":[["87310530bf95bee4"]]},{"id":"028d0a5172cb0da0","type":"function","z":"12d2f38ca9326654","name":"","func":"msg.payload=\n    \"{'a':1, 'b':\" +msg.payload+\"}\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1140,"y":480,"wires":[["87310530bf95bee4"]]},{"id":"87310530bf95bee4","type":"base64","z":"12d2f38ca9326654","name":"","action":"","property":"payload","x":1360,"y":560,"wires":[["9a2f3b4d3c0f4afd"]]},{"id":"b571e9eb5581790a","type":"debug","z":"12d2f38ca9326654","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1650,"y":560,"wires":[]},{"id":"4a59134bbef2080e","type":"ble connect","z":"12d2f38ca9326654","name":"연결","device":"e4a20789a9d815af","x":610,"y":100,"wires":[["2c45d06c66f0145a"]]},{"id":"fc6f0fd8261b78d2","type":"ui_button","z":"12d2f38ca9326654","name":"","group":"1c67a074.861f4","order":7,"width":0,"height":0,"passthru":false,"label":"연결","tooltip":"","color":"black","bgcolor":"{{background}}","className":"","icon":"arrow_forward","payload":"1","payloadType":"str","topic":"topic","topicType":"msg","x":250,"y":140,"wires":[["4a59134bbef2080e"]]},{"id":"0c0c858546d0f926","type":"inject","z":"12d2f38ca9326654","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payloadType":"date","x":260,"y":80,"wires":[["4a59134bbef2080e"]]},{"id":"bf8d51db4821fef4","type":"function","z":"12d2f38ca9326654","name":"","func":"msg.payload=\n    \"{'a':2, 'b':\" +msg.payload+\"}\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1100,"y":660,"wires":[["87310530bf95bee4"]]},{"id":"c22fe7e66f133a46","type":"ui_button","z":"12d2f38ca9326654","name":"","group":"1c67a074.861f4","order":7,"width":0,"height":0,"passthru":false,"label":"1번 전구 온","tooltip":"","color":"black","bgcolor":"{{background}}","className":"","icon":"arrow_forward","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":170,"y":260,"wires":[["ab9c69a257b4d3d3","028d0a5172cb0da0"]]},{"id":"56b1d69a4d20f88a","type":"ui_button","z":"12d2f38ca9326654","name":"","group":"1c67a074.861f4","order":7,"width":0,"height":0,"passthru":false,"label":"1번 전구 오프","tooltip":"","color":"black","bgcolor":"{{background}}","className":"","icon":"arrow_back","payload":"1","payloadType":"str","topic":"topic","topicType":"msg","x":180,"y":540,"wires":[["d5af53887f278d18","028d0a5172cb0da0"]]},{"id":"ab9c69a257b4d3d3","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":330,"y":300,"wires":[["851c57787f479c47","ee55699b25885e05"]]},{"id":"851c57787f479c47","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":530,"y":300,"wires":[["c53fd7bf629dcb5f"]]},{"id":"ee55699b25885e05","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"Lightgreen","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":400,"wires":[["c22fe7e66f133a46"]]},{"id":"c53fd7bf629dcb5f","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"skyblue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":400,"wires":[["c22fe7e66f133a46"]]},{"id":"d5af53887f278d18","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":370,"y":540,"wires":[["46a9d9a92216321c","a9dfc9b817c9b846"]]},{"id":"46a9d9a92216321c","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":570,"y":540,"wires":[["98bb437bcefbb597"]]},{"id":"a9dfc9b817c9b846","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"Lightgreen","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":640,"wires":[["56b1d69a4d20f88a"]]},{"id":"98bb437bcefbb597","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"skyblue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":640,"wires":[["56b1d69a4d20f88a"]]},{"id":"1a50fa1fd72a59ba","type":"ui_button","z":"12d2f38ca9326654","name":"","group":"1c67a074.861f4","order":7,"width":0,"height":0,"passthru":false,"label":"2번 전구 온","tooltip":"","color":"black","bgcolor":"{{background}}","className":"","icon":"arrow_forward","payload":"0","payloadType":"str","topic":"topic","topicType":"msg","x":130,"y":760,"wires":[["162737099ab97d93","bf8d51db4821fef4"]]},{"id":"0fef6266f30ffb50","type":"ui_button","z":"12d2f38ca9326654","name":"","group":"1c67a074.861f4","order":7,"width":0,"height":0,"passthru":false,"label":"2번 전구 오프","tooltip":"","color":"black","bgcolor":"{{background}}","className":"","icon":"arrow_back","payload":"1","payloadType":"str","topic":"topic","topicType":"msg","x":140,"y":1040,"wires":[["0b1f230d884bd297","bf8d51db4821fef4"]]},{"id":"162737099ab97d93","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":290,"y":800,"wires":[["e9f53c5aad743b54","50aa335ed8e2cd98"]]},{"id":"e9f53c5aad743b54","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":490,"y":800,"wires":[["027fc4bd4fb0012f"]]},{"id":"50aa335ed8e2cd98","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"Lightgreen","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":900,"wires":[["1a50fa1fd72a59ba"]]},{"id":"027fc4bd4fb0012f","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"skyblue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":880,"wires":[["1a50fa1fd72a59ba"]]},{"id":"0b1f230d884bd297","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":330,"y":1040,"wires":[["8be6485d0db2fef8","1860d2bcbed08e46"]]},{"id":"8be6485d0db2fef8","type":"delay","z":"12d2f38ca9326654","name":"","pauseType":"delay","timeout":"0.5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"x":530,"y":1040,"wires":[["62c7ab3bfccb210c"]]},{"id":"1860d2bcbed08e46","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"Lightgreen","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":1140,"wires":[["0fef6266f30ffb50"]]},{"id":"62c7ab3bfccb210c","type":"change","z":"12d2f38ca9326654","name":"","rules":[{"t":"set","p":"background","pt":"msg","to":"skyblue","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1140,"wires":[["0fef6266f30ffb50"]]},{"id":"1d63c4b1d56dbaef","type":"debug","z":"12d2f38ca9326654","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1140,"y":940,"wires":[]},{"id":"2c45d06c66f0145a","type":"function","z":"12d2f38ca9326654","name":"","func":"if(msg.payload.status==\"discovered\")\nmsg.payload=\"성공\";\nelse msg.payload==\"다시 시도해주세요\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":100,"wires":[["0f81d9c73baeff8d","38891624ec76cabf"]]},{"id":"0f81d9c73baeff8d","type":"debug","z":"12d2f38ca9326654","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1240,"y":120,"wires":[]},{"id":"38891624ec76cabf","type":"ui_text","z":"12d2f38ca9326654","group":"1c67a074.861f4","order":20,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-spread","className":"","x":1200,"y":220,"wires":[]},{"id":"e4a20789a9d815af","type":"bledevice","name":"BLE Example","address":"A4:CF:12:04:C0:2E"},{"id":"1c67a074.861f4","type":"ui_group","name":"수동","tab":"8e4884bb.ff1388","order":1,"disp":true,"width":"6","collapse":false},{"id":"8e4884bb.ff1388","type":"ui_tab","name":"터치","icon":"dashboard","disabled":false,"hidden":false}]
 
```
iot보드 관련 링크입니다.
https://techiesms.com/iot-projects/home-automation-using-tasmota-on-esp32/
https://techiesms.com/iot-projects/bluetooth-and-wifi-automation-using-esp32/


* 하드웨어 준비물 
ESP32
릴레이 3~4개
MCP4725 1개 
터미널 8개
10K옴 저항
330옴 저항
BC547 트렌지스터
1N4007 다이오드 
4R7 컨버터
LED전구 3개 
전선
푸쉬버튼